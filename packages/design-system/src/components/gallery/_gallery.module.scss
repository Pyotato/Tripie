@use "../../functions/" as *;
@use "../../mixins/" as *;
@use "sass:map";

$overlay-color: #fefefe;

.gallery {
  display: inline-grid;
  gap: space("sm");
  height: 100%;
  position: relative;

  img {
    width: 100%;
    height: 100%;
    position: relative !important;
    z-index: z("base") !important;
    object-fit: cover;
  }

  .overlay {
    filter: brightness(40%);
    position: absolute;
  }

  .image-container {
    position: relative;
    display: inline-block;
    cursor: pointer;

    &::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    &.post {
      grid-column: span 2;
      grid-row: span 1;
    }
  }

  .display-leftover-img-count {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: $overlay-color;
    z-index: z("default");
    font-size: font-size(h3);
    font-weight: bold;
  }

  @mixin gallery-template($i) {
    @if ($i==4) {
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(3, 1fr);
      .gallery-item {
        &:nth-child(1) {
          grid-column: span 3;
          grid-row: span 3;
        }
        &:nth-child(2),
        &:nth-child(3),
        &:nth-child(4) {
          grid-column: span 1;
          grid-column: span 1;
        }
      }
    } @else if($i==3) {
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(2, 1fr);
      .gallery-item {
        &:nth-child(1) {
          grid-column: span 3;
          grid-row: span 2;
        }
        &:nth-child(2),
        &:nth-child(3) {
          grid-column: span 1;
          grid-column: span 1;
        }
      }
    } @else if($i==2) {
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(1, 1fr);
      .gallery-item {
        grid-column: span 1;
        grid-row: span 1;
      }
    }
  }

  @for $i from 1 through 5 {
    &.gallery-img-length-#{$i}:not(.post) {
      width: 100%;
      overflow: hidden;
      @if $i == 5 {
        grid-template-columns: repeat(4, 1fr);
      } @else if ($i == 4) {
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        .gallery-item {
          &:nth-child(1) {
            grid-area: span 2 / 1 / auto / 3;
          }
          &:nth-child(2) {
            grid-area: 1 / 3 / auto / 5;
            > img {
              height: auto;
            }
          }
          &:nth-child(3) {
            grid-area: 2 / 3;
          }
          &:nth-child(4) {
            grid-area: 2 / 4;
          }
        }
      } @else {
        @include gallery-template($i);
      }

      .gallery-item {
        @if $i == 5 {
          &:nth-child(1) {
            grid-column: span 2;
            grid-row: span 2;
          }
          &:nth-child(n + 2):nth-child(-n + 5) {
            grid-column: span 1;
            grid-row: span 1;
          }
        }
      }
    }
  }

  // Post gallery
  &.post {
    @for $i from 1 through 5 {
      &.gallery-img-length-#{$i} {
        @if $i == 5 {
          grid-template-columns: repeat(6, 1fr);
          grid-template-rows: repeat(2, 1fr);
          .gallery-item {
            &:nth-child(1),
            &:nth-child(2) {
              grid-column: span 3;
            }
            &:nth-child(n + 3):nth-child(-n + 5) {
              grid-column: span 2;
            }
          }
        }
        @include gallery-template($i);
      }
    }
  }
}
